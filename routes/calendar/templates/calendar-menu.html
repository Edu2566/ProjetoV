{% extends "sideheader.html" %}

{% block stylepage %}
<link rel="stylesheet" href="{{ url_for('calendar.static', filename='/css/calendarStyle.css') }}">
{% endblock %}

{% block titlepage %}Vestibulobby - Calendário{% endblock %}

{% block classactivecalendario %}active{% endblock %}

{% block mainclass %}open-state{% endblock %}
{% block mainid %}calendario_main{% endblock %}

{% block main %}
<div class="calendar-navigation">
    <div class="nav-button">
        <a href="{{ url_for('calendar.calendar_menu', year=year, month=month, action='prev_year') }}">◀</a>
    </div>
    <div class="year">{{year}}</div>
    <div class="nav-button">
        <a href="{{ url_for('calendar.calendar_menu', year=year, month=month, action='next_year') }}">▶</a>
    </div>
</div>

<div class="calendar-navigation">
    <div class="nav-button">
        <a href="{{ url_for('calendar.calendar_menu', year=year, month=month, action='prev_month') }}">◀</a>
    </div>
    <div class="month">{{month_name_pt}}</div>
    <div class="nav-button">
        <a href="{{ url_for('calendar.calendar_menu', year=year, month=month, action='next_month') }}">▶</a>
    </div>
</div>

<div class="calendar-container">
    {{ calendar | safe }}
</div>

<div id="eventModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Adicionar Evento</h2>
            <span class="close" onclick="closeModal()">&times;</span>
        </div>
        <form id="eventForm" method="POST" action="{{ url_for('calendar.add_event') }}">
            <input type="hidden" id="eventDate" name="date">
            <input type="text" name="event" placeholder="Nome do Evento" required autocomplete="off">
            <button type="submit">Salvar Evento</button>
        </form>
        <h3>Eventos:</h3>
        <ul id="eventList">
            <!-- A lista de eventos será preenchida aqui com JavaScript -->
        </ul>
    </div>
</div>

<!-- Nova seção para a lista de todos os eventos -->
<div class="event-list">
    <h3>Todos os Eventos</h3>
    <ul id="allEventsList">
        {% for date, event_list in events.items() %}
            {% for event in event_list %}
                <li  onclick="openUpdateModal('{{ date }}', '{{ event }}')">{{ event }} - {{ date }}
                    <button onclick="toggleCompletionAll(event)">Concluído</button>
                </li>
            {% endfor %}
        {% endfor %}
    </ul>
</div>

<!-- Modal para Visualizar, Atualizar e Excluir Evento -->
<div id="updateEventModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Editar Evento</h2>
            <span class="close" onclick="closeUpdateModal()">&times;</span>
        </div>
        <form id="updateEventForm" method="POST" action="{{ url_for('calendar.update_event') }}">
            <input type="hidden" id="updateEventDate" name="date">
            <input type="hidden" id="oldEventName" name="old_event_name">
            <input type="text" id="newEventName" name="new_event_name" required>
            <button type="submit">Salvar Alterações</button>
        </form>
        <button onclick="deleteEvent()">Excluir Evento</button>
    </div>
</div>

<div id="calendar-events" style="display:none;">
    {{ events|tojson }}
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('calendar.static', filename='js/calendar.js') }}"></script>
{% endblock %}


